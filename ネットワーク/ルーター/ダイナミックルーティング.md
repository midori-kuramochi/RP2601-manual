# ダイナミックルーティング

## ダイナミックルーティング（OSPF）手順書（4台リング / Packet Tracer）

### 目的

* 4台ルータをリング状に接続し、**OSPF(プロセスID 10 / area 0)** で経路交換する
* `show ip ospf neighbor` で隣接が FULL になること
* `show ip route` に `O`（OSPF）経路が載り、遠隔ネットワークへ疎通できること

### 1. トポロジ・IPアドレス設計

#### 物理接続（リング）

* rt01—rt02：`172.31.0.0/24`
* rt01—rt03：`172.31.1.0/24`
* rt02—rt04：`172.31.2.0/24`
* rt03—rt04：`172.31.3.0/24`

#### 各ルータのIP

* **rt01**

  * Gi0/0/0：`172.31.0.1/24`
  * Gi0/0/1：`172.31.1.1/24`
* **rt02**

  * Gi0/0/0：`172.31.0.2/24`
  * Gi0/0/1：`172.31.2.1/24`
* **rt03**

  * Gi0/0/0：`172.31.1.3/24`
  * Gi0/0/1：`172.31.3.3/24`
* **rt04**

  * Gi0/0/0：`172.31.2.4/24`
  * Gi0/0/1：`172.31.3.4/24`

---

### 2. 各ルータ：インターフェース設定（共通手順）

例（rt01）：

```ios
enable
conf t
interface g0/0/0
 ip address 172.31.0.1 255.255.255.0
 no shutdown
interface g0/0/1
 ip address 172.31.1.1 255.255.255.0
 no shutdown
end
show ip interface brief
```

※ rt02/rt03/rt04 も同様に、指定IPを割り当てる。


### 3. OSPF設定（共通テンプレ）

#### テンプレ

```ios
rt01> enable
rt01# configure terminal
rt01(config)# router ospf 10
rt01(config-if)# network <ネットワークアドレス> 0.0.0.255 area 0
rt01(config-if)# network <ネットワークアドレス> 0.0.0.255 area 0
rt01(config-if)# end
```

* /24 のワイルドカード：`0.0.0.255`
* `network` は「該当するIPを持つIFでOSPFを有効化する」指定


#### ルータ別：OSPFの network 指定

##### rt01（172.31.0.0/24 と 172.31.1.0/24）

```ios
conf t
router ospf 10
 network 172.31.0.0 0.0.0.255 area 0
 network 172.31.1.0 0.0.0.255 area 0
end
```

##### rt02（172.31.0.0/24 と 172.31.2.0/24）

```ios
conf t
router ospf 10
 network 172.31.0.0 0.0.0.255 area 0
 network 172.31.2.0 0.0.0.255 area 0
end
```

##### rt03（172.31.1.0/24 と 172.31.3.0/24）

```ios
conf t
router ospf 10
 network 172.31.1.0 0.0.0.255 area 0
 network 172.31.3.0 0.0.0.255 area 0
end
```

##### rt04（172.31.2.0/24 と 172.31.3.0/24）

```ios
conf t
router ospf 10
 network 172.31.2.0 0.0.0.255 area 0
 network 172.31.3.0 0.0.0.255 area 0
end
```

---

### 4. 動作確認

#### 4-1. OSPF隣接確認

```ios
show ip ospf neighbor
```

期待値：

* 各ルータで **Neighbor が2つ**（リングなので左右に1台ずつ）
* State が `FULL` になっている


#### 4-2. ルーティングテーブル確認

```ios
show ip route
```

* `C`：直結（connected）
* `L`：自分自身のIFのIP（local /32）
* `O`：OSPFで学習した経路


### 5. 貼ってくれた出力の読み方（これは rt04 の結果っぽい）

#### `show ip ospf neighbor`

```
Neighbor ID     ... State     Address     Interface
172.31.3.3          FULL/...  172.31.3.3  Gi0/0/1
172.31.2.2          FULL/...  172.31.2.2  Gi0/0/0
```

* Gi0/0/1 側（172.31.3.0/24）で **rt03(172.31.3.3)** と隣接
* Gi0/0/0 側（172.31.2.0/24）で **rt02 側と隣接**
  ※ここ、rt02の指定IPは `172.31.2.1` のはずなので、`172.31.2.2` が出てるのは「rt02のそのIFが .2 になっている」or「別IF/別機器」を見てる可能性あり。
  手順書的には **“隣接がFULLならOK。相手IPは設計通りかも確認”** と書くのが安全。

## `show ip route`

```
O 172.31.0.0/24 via 172.31.2.2 Gi0/0/0
O 172.31.1.0/24 via 172.31.3.3 Gi0/0/1
C 172.31.2.0/24 is directly connected Gi0/0/0
C 172.31.3.0/24 is directly connected Gi0/0/1
```

意味：

* 自分（このルータ）は `172.31.2.0/24` と `172.31.3.0/24` に直結（C）
* `172.31.0.0/24` は **rt02側（Gi0/0/0方向）** から学習（O）
* `172.31.1.0/24` は **rt03側（Gi0/0/1方向）** から学習（O）

→ つまり、OSPFで **リングの反対側ネットワーク** まで学習できてる状態でOK。


### 6. 疎通テスト（推奨）

例：rt04 から rt01 のIFへ

```ios
rt04# ping 172.31.0.1
rt04# ping 172.31.1.1
```

rt01 から rt04 へ

```ios
rt01# ping 172.31.2.4
rt01# ping 172.31.3.4
```
---