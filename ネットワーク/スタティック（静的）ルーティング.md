# スタティックルーティング（静的ルーティング）手順書（rt01—rt02—rt03）


対象：Packet Tracer / Cisco IOS（Router / L3 Switch）

### 0. 前提・ルール（最初に必ず確認）

#### 前提

* 機器：rt01, rt02,rt03（Router想定。L3SWでも可）
* 接続：rt01 Gi0/0/0 ↔ rt02 Gi0/0/0  | rt02 Gi0/0/1 ↔ rt03 Gi0/0/0 
* ネットワーク：`172.31.0.0/24` | `172.31.1.0/24`
* rt01,rt02は設置済み。接続確認も済んでいることとする

#### 構成図
![alt text](<スクリーンショット 2026-02-18 113547.png>)

#### ルール

* 以降、プロンプト表記は `Router#` を基本とする（機器名は環境により異なる）
* 物理IFのIP設定後は必ず **`no shutdown`** と **状態確認** を行う
* 設定後は必要に応じて **保存（copy run start）** を行う（PTでも習慣化）

---

### 1. ネットワーク構成（固定）

#### 1-1. 接続とアドレス
- rt01—rt02：`172.31.0.0/24`
  - rt01 Gi0/0/0：`172.31.0.1/24`（設定済）
  - rt02 Gi0/0/0：`172.31.0.2/24`（設定済）
- rt02—rt03：`172.31.1.0/24`
  - rt02 Gi0/0/1：`172.31.1.2/24`
  - rt03 Gi0/0/0：`172.31.1.3/24`

#### 1-2. ゴール
- rt01 ↔ rt03 間で ping が成功（戻り経路含めて疎通）
- `show ip route` で静的ルート（S）が意図通り載る

---

### 2. L3IF設定（rt02—rt03間）
> ここでは **rt02 Gi0/0/1** と **rt03 Gi0/0/0** を設定して、直結セグメント `172.31.1.0/24` を成立させる。

---

### 2-1. rt03：Gi0/0/0 にIP設定
起動直後の初期ダイアログはスキップ：

```text
Would you like to enter the initial configuration dialog? [yes/no]: no
Press RETURN to get started!
```

設定：

```ios
rt03> enable
rt03# configure terminal
rt03(config)# interface gigabitEthernet 0/0/0
rt03(config-if)# ip address 172.31.1.3 255.255.255.0
rt03(config-if)# no shutdown
rt03(config-if)# end
rt03# show ip interface brief
```

期待：

```text
GigabitEthernet0/0/0   172.31.1.3   YES manual   up   up
```

補足（PTあるある）：
- `down/down` が一瞬出ても、`%LINEPROTO-5-UPDOWN ... changed state to up` が出て **up/up** になればOK

---

### 2-2. rt02：Gi0/0/1 にIP設定（rt03側）
```ios
rt02> enable
rt02# configure terminal
rt02(config)# interface gigabitEthernet 0/0/1
rt02(config-if)# ip address 172.31.1.2 255.255.255.0
rt02(config-if)# no shutdown
rt02(config-if)# end
rt02# show ip interface brief
```

期待：

```text
GigabitEthernet0/0/1   172.31.1.2   YES manual   up   up
```

---

## 3. 同一セグメント疎通確認（直結を先に固める）
### 3-1. rt03 → rt02（172.31.1.3 → 172.31.1.2）
```ios
rt03# ping 172.31.1.2
```

- 1回目 `.!!!!`（80%）はARP解決の影響でよくある  
- 2回目以降 `!!!!!`（100%）になればOK

### 3-2. rt02 → rt03（172.31.1.2 → 172.31.1.3）
```ios
rt02# ping 172.31.1.3
```

---

## 4. 別ネットワーク越し疎通が失敗することを確認（原因の再現）
### 4-1. rt01 → rt03（172.31.0.1 → 172.31.1.3）
```ios
rt01# ping 172.31.1.3
```

想定結果：`.....`（0%）

### 4-2. 失敗の原因
- rt01 は直結している `172.31.0.0/24` 以外（=`172.31.1.0/24`）への **経路（ルート）を持っていない**
- そのため `172.31.1.3` 宛パケットの転送先（次ホップ）が決められず破棄される

---

## 5. 静的ルートを設定（rt01 ↔ rt03 の“行き”と“戻り”）
> ポイント：**rt02は両セグメントに直結**しているため、通常は `ip route` を追加しなくても中継できる。  
> 必要なのは **端（rt01・rt03）に「相手側ネットワークへのルート」**。

---

### 5-0. ルーティング確認（設定前）
```ios
rt01# show ip route
rt03# show ip route
```

確認ポイント：
- rt01 に `172.31.1.0/24` がない
- rt03 に `172.31.0.0/24` がない
- rt02 は `172.31.0.0/24` と `172.31.1.0/24` が **Connected（C）** として載るはず

（任意：設定の見える化）
```ios
rt01# show running-config | include ^ip route
rt03# show running-config | include ^ip route
```

---

### 5-1. rt01 に静的ルートを追加（行き：172.31.1.0/24 → rt02へ）
「`172.31.1.0/24` は rt02（次ホップ `172.31.0.2`）へ送る」

```ios
rt01# configure terminal
rt01(config)# ip route 172.31.1.0 255.255.255.0 172.31.0.2
rt01(config)# end
```

---

### 5-2. rt03 に静的ルートを追加（戻り：172.31.0.0/24 → rt02へ）
「`172.31.0.0/24` は rt02（次ホップ `172.31.1.2`）へ送る」

```ios
rt03# configure terminal
rt03(config)# ip route 172.31.0.0 255.255.255.0 172.31.1.2
rt03(config)# end
```

---

### 5-3. ルーティング確認（設定後）
```ios
rt01# show ip route | include 172.31.1.0
rt03# show ip route | include 172.31.0.0
```

期待イメージ：
- rt01：`S 172.31.1.0/24 [1/0] via 172.31.0.2`
- rt03：`S 172.31.0.0/24 [1/0] via 172.31.1.2`

（任意：設定の見える化）
```ios
rt01# show running-config | include ^ip route
rt03# show running-config | include ^ip route
```

---

### 5-4. 最終疎通確認（ping）
```ios
rt01# ping 172.31.1.3
rt03# ping 172.31.0.1
```

- 最初の1発はARP等で落ちる可能性があるため **2回実行して `!!!!!` を確認**する

---

### 5-5. （推奨）経路確認（traceroute）
どこを通っているか確認（中継がrt02になっていること）：

```ios
rt01# traceroute 172.31.1.3
rt03# traceroute 172.31.0.1
```

---

### 5-6. （推奨）設定保存
```ios
rt01# copy running-config startup-config
rt03# copy running-config startup-config
rt02# copy running-config startup-config
```

---

## 6. 失敗時の切り分けチェック（最短）
1. **IFがup/upか**  
   - `show ip interface brief`
2. **直結の次ホップに届くか**（ここが落ちてたらルート以前）  
   - rt01 → `ping 172.31.0.2`  
   - rt03 → `ping 172.31.1.2`
3. **静的ルートが入っているか（設定＆経路表）**  
   - rt01：`show ip route | include 172.31.1.0`  
   - rt03：`show ip route | include 172.31.0.0`  
   - `show run | include ^ip route`
4. **rt02が両方のConnectedを持っているか**  
   - rt02：`show ip route | include 172.31.0.0|172.31.1.0`
5. **経路が想定通りか（traceroute）**  
   - `traceroute` の1ホップ目が rt02 になっているか

---

## 7. 完了条件（チェックリスト）
- [ ] rt02 Gi0/0/1 と rt03 Gi0/0/0 が up/up  
- [ ] rt03 ↔ rt02（172.31.1.0/24）が ping 成功  
- [ ] rt01 へ `ip route 172.31.1.0/24 via 172.31.0.2` を追加済み  
- [ ] rt03 へ `ip route 172.31.0.0/24 via 172.31.1.2` を追加済み  
- [ ] rt01 ↔ rt03 が ping 成功（2回目以降100%でOK）  
- [ ] （任意）traceroute で rt02 を経由していることを確認  
- [ ] 設定を保存済み
